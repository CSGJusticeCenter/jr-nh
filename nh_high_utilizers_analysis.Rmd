---
title: "High Utilizers Trends"
output: 
  distill::distill_article:
    toc: true
    toc_depth: 3
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo=FALSE, 
  message=FALSE, 
  warning=FALSE,
  #dev = "ragg_png",
  cache = FALSE
  )

# load packages
source("data_cleaning/00_library.R")

# load data
load(paste0(sp_data_path, "/Data/r_data/hu_bookings_table.Rda",               sep = ""))
load(paste0(sp_data_path, "/Data/r_data/hu_bookings_table_by_county.Rda",     sep = ""))
load(paste0(sp_data_path, "/Data/r_data/nonhu_bookings_table.Rda",            sep = ""))
load(paste0(sp_data_path, "/Data/r_data/nonhu_bookings_table_by_county.Rda",  sep = ""))
load(paste0(sp_data_path, "/Data/r_data/hu_bookings_month_year.Rda",          sep = ""))

load(paste0(sp_data_path, "/Data/r_data/hu_bookings_fy_1_pct.Rda",            sep = ""))
load(paste0(sp_data_path, "/Data/r_data/hu_bookings_fy_3_pct.Rda",            sep = ""))
load(paste0(sp_data_path, "/Data/r_data/hu_bookings_fy_5_pct.Rda",            sep = ""))
load(paste0(sp_data_path, "/Data/r_data/hu_pc_holds_fy_1_pct_gg.Rda",         sep = ""))
load(paste0(sp_data_path, "/Data/r_data/hu_pc_holds_fy_3_pct_gg.Rda",         sep = ""))
load(paste0(sp_data_path, "/Data/r_data/hu_pc_holds_fy_5_pct_gg.Rda",         sep = ""))
load(paste0(sp_data_path, "/Data/r_data/hu_pc_holds_135_pct_gg.Rda",          sep = ""))
load(paste0(sp_data_path, "/Data/r_data/los_summary_135_pct.Rda",             sep = ""))
load(paste0(sp_data_path, "/Data/r_data/los_category_by_hu_gg.Rda",           sep = ""))
load(paste0(sp_data_path, "/Data/r_data/one_day_booking_types_135_pct.Rda",   sep = ""))
```

# How we define High Utilizers

Using the jail administrative data submitted to CSG, we defined high utilizers (HU) as the top 1%, 3%, or 5% of people booked into jails each FY.


# Jail Bookings

## By Fiscal Year

```{r}
hu_bookings_month_year
```

The table below shows the number of HU bookings, proportion of HU bookings out of all bookings, and the average number of bookings per year for the three types of HU's for each FY and for all three years.  

```{r}
hu_bookings_table
```

### How non-HU's Compare

In the tables below, we define non-HU's as people who are not in the top 1%, 3%, and 5% of people booked into jail.

The table below shows the number of non-HU bookings, proportion of non-HU bookings out of all bookings, and the average number of bookings per year for the three types of non-HU's for each FY and for all three years.  

```{r}
nonhu_bookings_table
```

**Top 1% - Proportion of Bookings That Were High Utilizers**

```{r}
hu_bookings_fy_1_pct
```
**Top 3% - Proportion of Bookings That Were High Utilizers**

```{r}
hu_bookings_fy_3_pct
```

**Top 5% - Proportion of Bookings That Were High Utilizers**

```{r}
hu_bookings_fy_5_pct
```

## By County

The table below shows the number of HU bookings, proportion of HU bookings out of all bookings, and the average number of bookings per year for the three types of HU's for each county between FY2019 - FY2020.

```{r}
hu_bookings_table_by_county
```

### How non-HU's Compare

In the tables below, we define non-HU's as people who are not in the top 1%, 3%, and 5% of people booked into jail.

The table below shows the number of non-HU bookings, proportion of non-HU bookings out of all bookings, and the average number of bookings per year for the three types of non-HU's for each county for each county between FY2019 - FY2020.

```{r}
nonhu_bookings_table_by_county
```

# What Proportion of HU Bookings are PC Holds?

**Overall**

```{r, results='asis'}
temp <- hu_pc_holds_135_pct_gg$data %>% 
  filter(pc_hold_in_booking == "PC Hold Booking" & hu == "Top 5%")
temp <- temp$pct
temp1 <- hu_pc_holds_135_pct_gg$data %>% 
  filter(pc_hold_in_booking == "PC Hold Booking" & hu == "Top 1%")
temp1 <- temp1$pct

cat("**", temp, " of top 5% high utilizer bookings were PC holds. This increases to " , temp1, " for top 1% high utilizers**.\n\n", sep = "")
```

```{r}
hu_pc_holds_135_pct_gg
```


**Top 1%**

```{r, results='asis'}
temp <- hu_pc_holds_fy_1_pct_gg$data %>% 
  filter(pc_hold_in_booking == "PC Hold Booking" & fy == 2019)
temp <- temp$pct
temp <- gsub('%','',temp)
temp <- as.numeric(temp)

temp1 <- hu_pc_holds_fy_1_pct_gg$data %>% 
  filter(pc_hold_in_booking == "PC Hold Booking" & fy == 2021)
temp1 <- temp1$pct
temp1 <- gsub('%','',temp1)
temp1 <- as.numeric(temp1)

temp <- temp1-temp
cat("**The proportion of top 1% high utilizer bookings that were PC holds increased ", temp, "% from FY2019 to FY2021**.\n\n", sep = "")
```

```{r}
hu_pc_holds_fy_1_pct_gg
```
**Top 3%**

```{r, results='asis'}
temp <- hu_pc_holds_fy_3_pct_gg$data %>% 
  filter(pc_hold_in_booking == "PC Hold Booking" & fy == 2019)
temp <- temp$pct
temp <- gsub('%','',temp)
temp <- as.numeric(temp)

temp1 <- hu_pc_holds_fy_3_pct_gg$data %>% 
  filter(pc_hold_in_booking == "PC Hold Booking" & fy == 2021)
temp1 <- temp1$pct
temp1 <- gsub('%','',temp1)
temp1 <- as.numeric(temp1)

temp <- temp1-temp
cat("**The proportion of top 3% high utilizer bookings that were PC holds increased ", temp, "% from FY2019 to FY2021**.\n\n", sep = "")
```

```{r}
hu_pc_holds_fy_3_pct_gg
```

**Top 5%**

```{r, results='asis'}
temp <- hu_pc_holds_fy_5_pct_gg$data %>% 
  filter(pc_hold_in_booking == "PC Hold Booking" & fy == 2019)
temp <- temp$pct
temp <- gsub('%','',temp)
temp <- as.numeric(temp)

temp1 <- hu_pc_holds_fy_5_pct_gg$data %>% 
  filter(pc_hold_in_booking == "PC Hold Booking" & fy == 2021)
temp1 <- temp1$pct
temp1 <- gsub('%','',temp1)
temp1 <- as.numeric(temp1)

temp <- temp1-temp
cat("**The proportion of top 5% high utilizer bookings that were PC holds increased ", temp, "% from FY2019 to FY2021**.\n\n", sep = "")
```

```{r}
hu_pc_holds_fy_5_pct_gg
```

# Length of Stay

```{r}
los_summary_135_pct
```

```{r}
los_category_by_hu_gg
```
```{r}
one_day_booking_types_135_pct
```

